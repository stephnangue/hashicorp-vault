---
- name: test
  become: yes
  hosts: centos
  vars:
    ansible_ssh_common_args: -o StrictHostKeyChecking=no -o ForwardAgent=yes -o User=ec2-user


  tasks:
    - name: test
      ansible.builtin.shell: | 
        metadata="http://169.254.169.254/latest/meta-data"
        mac=$(curl -s $metadata/network/interfaces/macs/ | head -n1 | tr -d '/')
        cidr=$(curl -s $metadata/network/interfaces/macs/$mac/vpc-ipv4-cidr-block/ | cut -d '/' -f 1)
        dns=$(echo $cidr | sed 's/.$/2/')
        echo $dns
      register: aws_dns_resolver

    - debug:
        var: aws_dns_resolver.stdout